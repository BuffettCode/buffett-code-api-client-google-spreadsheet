<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <script>
      function onLoadSettingError(e) {
        console.error(e.message, e.stack)
        alert(`設定の読み込みでエラーが発生しました: ${e.message}`)
      }

      function onSaveSettingError(e) {
        console.error(e.message, e.stack)
        alert(`設定の保存でエラーが発生しました: ${e.message}`)
      }

      function loadSetting() {
        google.script.run
          .withFailureHandler(onLoadSettingError)
          .withSuccessHandler((setting) => {
            if (setting.token) {
              document.getElementById('token-input').value = setting.token
            }
            if (setting.ondemandApiEnabled) {
              document.getElementById('ondemand-api-check').checked = setting.ondemandApiEnabled
            }
          })
          .loadSetting()
      }

      function saveSetting() {
        const token = document.getElementById('token-input').value
        const ondemandApiEnabled = document.getElementById('ondemand-api-check').checked

        google.script.run
          .withFailureHandler(onSaveSettingError)
          .withSuccessHandler(() => {
            alert('設定を保存しました')
            google.script.host.close()
          })
          .saveSetting(token, ondemandApiEnabled)
      }
    </script>
  </head>
  <body>
    <div class="sidebar">
      <div class="block">
        <label for="token-input"><b>APIトークン</b></label>
        <input id="token-input" type="text">
      </div>
      <div class="block">
        <label for="token-input"><b>従量課金APIを利用する</b></label>
        <input id="ondemand-api-check" type="checkbox">
      </div>
      <div class="block">
        <button class="action" onclick="saveSetting()">保存</button>
        <button onclick="google.script.host.close()">キャンセル</button>
      </div>
    </div>
  </body>
  <script>
    (function() {
      loadSetting()
    })()
  </script>
</html>
